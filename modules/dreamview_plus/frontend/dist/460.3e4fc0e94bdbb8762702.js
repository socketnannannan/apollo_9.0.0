"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[460],{73994:(e,n,t)=>{t.r(n),t.d(n,{default:()=>M});var i=t(40366),r=t.n(i),l=t(37165),a=t(47960),o=t(36242),c=t(46533),u=t(84436),s=t(53654),b=t(38129),f=t(96676),d=t(2975),y=t(83517),p=t(60346),v=t(11446),m={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!0,currentVisible:!0,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!0,currentVisible:!0,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"cameraSensor"},v2x:{defaultVisible:!0,currentVisible:!0,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!1,currentVisible:!1,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!1,currentVisible:!1,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectory:{defaultVisible:!1,currentVisible:!1,vizKey:"planningTrajectory"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!1,currentVisible:!1,vizKey:"crosswalk"},clearArea:{defaultVisible:!1,currentVisible:!1,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!1,currentVisible:!1,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!1,currentVisible:!1,vizKey:"signal"},stopSign:{defaultVisible:!1,currentVisible:!1,vizKey:"stopSign"},yieldSign:{defaultVisible:!1,currentVisible:!1,vizKey:"yieldSign"},speedBump:{defaultVisible:!1,currentVisible:!1,vizKey:"speedBump"},parkingSpace:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},V=function(e){var n={};return Object.keys(e).forEach((function(t){var i=e[t];Object.keys(i).forEach((function(e){var r=i[e];n[t]=n[t]||{},n[t][r.vizKey]=r.currentVisible}))})),n},g=new v.DT(v.qK.PointCloudLayerMenu),h=function(){return g.get()||m},z=t(1434);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach((function(n){E(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function E(e,n,t){var i;return i=function(e,n){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=K(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==K(i)?i:i+"")in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function O(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],c=!0,u=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return C(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?C(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function P(e){var n=(0,b.A)().classes,t=e.carviz,o=e.obstacleChannels,c=e.updateObstacleChannel,u=e.closeChannel,s=e.showPerception,f=e.setShowPerception,d=e.curChannel,y=e.setCurChannel,p=(0,a.Bd)("layerMenu").t,v=(0,a.Bd)("panels").t,m=h();g.set(m),t.option.updateLayerOption(V(m),"pointCloud");var K=O((0,i.useState)(m),2),S=K[0],C=K[1],P=O((0,i.useState)(Object.keys(S)),1)[0],j=O((0,i.useState)(P[0]),1)[0],k=O((0,i.useState)(S[j]),2)[1];return r().createElement("div",{className:n["layer-menu-container"]},r().createElement("div",{className:n["layer-menu-header"]},r().createElement("div",{className:n["layer-menu-header-left"]},v("layerMenu"))),r().createElement("div",{className:n["layer-menu-content"]},r().createElement("div",{className:n["layer-menu-content-left"]},r().createElement("span",{className:n["layer-menu-content-right-switch"],style:{display:"inline-block",marginTop:"6px"}},r().createElement(l.Sc,{checked:s,defaultChecked:!0,onChange:function(e){e.target.checked&&o.length?(f(!0),c(d)):(f(!1),u())}})),p("perception")),r().createElement("div",{className:n["layer-menu-content-right"]},r().createElement(z.A,{value:d,options:o,onChange:function(e){return function(e){y(e),c(e)}(e)}}),r().createElement("div",{className:n["layer-menu-horizontal-line"]}),r().createElement("li",{className:n["layer-menu-content-right-li"]},r().createElement("span",{className:n["layer-menu-content-right-switch"]},r().createElement(l.sx,{checked:S.Perception.polygon.currentVisible,onChange:function(e){if(e.target.checked){var n=w(w({},S.Perception),{},{polygon:w(w({},S.Perception.polygon),{},{currentVisible:!0}),boundingbox:w(w({},S.Perception.boundingbox),{},{currentVisible:!1})}),i=w(w({},S),{},E({},j,n));k((function(){return n})),C((function(){return i})),t.option.updateLayerOption(V(i),"vehicle"),g.set(i)}}})),r().createElement("span",{className:n["layer-menu-content-right-label"]},p("polygon"))),r().createElement("li",{className:n["layer-menu-content-right-li"]},r().createElement("span",{className:n["layer-menu-content-right-switch"]},r().createElement(l.sx,{checked:S.Perception.boundingbox.currentVisible,onChange:function(e){if(e.target.checked){var n=w(w({},S.Perception),{},{polygon:w(w({},S.Perception.polygon),{},{currentVisible:!1}),boundingbox:w(w({},S.Perception.boundingbox),{},{currentVisible:!0})}),i=w(w({},S),{},E({},j,n));k((function(){return n})),C((function(){return i})),t.option.updateLayerOption(V(i),"vehicle"),g.set(i)}}})),r().createElement("span",{className:n["layer-menu-content-right-label"]},p("boundingbox"))))))}function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function k(e,n,t){var i;return i=function(e,n){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=j(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==j(i)?i:i+"")in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function D(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],c=!0,u=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return A(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?A(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function N(){var e=D((0,i.useState)(!0),2),n=e[0],t=e[1],p=D((0,i.useState)(null),2),v=p[0],m=p[1],z=(0,y.d)(),K=D((0,o.qZ)(),1)[0],S=z.initSubscription,w=z.setKeyDownHandlers,E=z.removeKeyDownHandlers,O=(0,b.A)().classes,C=D((0,i.useState)("D"),2),j=C[0],A=C[1],N=D((0,s.A)(),2),I=N[0],M=N[1],x=(0,a.Bd)("panels").t,L=D((0,i.useState)(null),2),T=L[0],R=L[1],B=(0,u.A)(),U=B.metadata,_=B.isMainConnected,q=B.streamApi,H=(0,i.useRef)(null),W=(0,i.useMemo)((function(){return U.find((function(e){return"obstacle"===e.dataName}))}),[U,_]),F=(0,i.useMemo)((function(){return W?W.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[W]),J=function(){null==I||I.updateData({object:[],autoDrivingCar:{}}),H.current&&H.current.subscription&&(H.current.subscription.unsubscribe(),H.current=null)},$=function(e){J();var n=q.subscribeToDataWithChannel("obstacle",e).subscribe((function(e){var n={CopyAutoDrivingCar:e.autoDrivingCar,object:e.obstacle||[]};null==I||I.updateData(n)}));H.current={name:"obstacle",subscription:n}};(0,i.useEffect)((function(){I.init();var e=h();g.set(e),I.option.updateLayerOption(V(e),"pointCloud")}),[]),(0,i.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=I.view)||void 0===n||n.updateViewDistance(-10)},discriptor:x("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=I.view)||void 0===n||n.updateViewDistance(-10)},discriptor:x("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=I.view)||void 0===n||n.updateViewDistance(10)},discriptor:x("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=I.view)||void 0===n||n.updateViewDistance(10)},discriptor:x("zoomOut")}];return w(e),function(){E(e)}}),[x]),(0,i.useEffect)((function(){if(F&&0!==F.length&&q){var e=F[0];m(e.value),n&&$(e.value)}}),[F,q]),(0,i.useEffect)((function(){return function(){var e;null===(e=H.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]),(0,i.useEffect)((function(){S(k(k({},c.lt.SIM_WORLD,{consumer:function(e){I.adc.updateOffset(e.autoDrivingCar,"adc")}}),c.lt.POINT_CLOUD,{consumer:function(e){R(e)}}))}),[]),(0,i.useEffect)((function(){T&&(null==I||I.updatePointCloud(T))}),[T]);var Y=(0,i.useRef)(0),Z=function e(){null==I||I.render(),Y.current=requestAnimationFrame(e)};(0,i.useEffect)((function(){return Z(),function(){var e=Y.current;e&&cancelAnimationFrame(e)}}),[]),(0,i.useEffect)((function(){R(null),null==I||I.removeAll()}),[K.currentRecordId]);var G=r().createElement(P,{curChannel:v,setCurChannel:m,carviz:I,obstacleChannels:F,updateObstacleChannel:$,closeChannel:J,showPerception:n,setShowPerception:t});return r().createElement("div",{className:O["viz-container"]},r().createElement("div",{id:M,className:O["web-gl"]}),r().createElement("div",{className:O["viz-btn-container"]},r().createElement(d.A,{carviz:I},r().createElement(l.AM,{placement:"leftTop",trigger:"click",content:G},r().createElement("span",{className:O["viz-btn-item"]},r().createElement(l.Yx,null))),r().createElement(l.AM,{placement:"leftTop",content:r().createElement(f.A,{carviz:I,setCurrentView:A}),trigger:"click"},r().createElement("span",{className:O["viz-btn-item"]},null==j?void 0:j.charAt(0))))))}function I(e){var n=(0,i.useMemo)((function(){return(0,p.A)({PanelComponent:N,panelId:e.panelId,subscribeInfo:[{name:c.lt.POINT_CLOUD,needChannel:!0},{name:c.lt.SIM_WORLD,needChannel:!1}]})}),[]);return r().createElement(n,e)}N.displayName="PointCloud";const M=r().memo(I)}}]);